var h=Object.defineProperty;var p=(t,e,n)=>e in t?h(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var i=(t,e,n)=>p(t,typeof e!="symbol"?e+"":e,n);const g=["is","are","was","were","be","has","have","had","did","does","do","shows","show","suggests","suggest","demonstrates","demonstrate","indicates","indicate","states","state","reports","report","finds","find","found","supports","support","causes","cause","correlates","correlate","improves","improve","reduces","reduce","increases","increase","invades","invaded"];function v(t){return t.toLowerCase().match(/[a-z']+/g)||[]}function C(t){return t.some(e=>g.includes(e))?!0:t.some(e=>e.length<4?!1:!!(/(ed|ing)$/.test(e)||e.endsWith("s")&&!e.endsWith("ss")&&e.length>=5))}function o(t){return t.replace(/\s+/g," ").trim()}function a(t){const e=o(t);if(!e)return"";const n=e.split(new RegExp("(?<=[.!?;:])\\s+")).filter(Boolean);if(n.length===0)return"";const s=o(n[n.length-1]),r=n.length>1?o(n[n.length-2]):"";return/[.!?;:]$/.test(s)?s:r}function l(t){const e=o(t);if(!e||!/[.!?;:]$/.test(e))return!1;const n=v(e);return n.length<4?!1:C(n)}function S(t){const e=t.selectionStart??t.value.length,n=t.value.slice(0,e);return a(n)}function E(t){const e=t.ownerDocument.getSelection();if(!e||e.rangeCount===0)return"";const n=e.getRangeAt(0).cloneRange();n.setStart(t,0);const s=n.toString();return a(s||t.textContent||"")}function m(t){const e=t.activeElement;return e?e instanceof HTMLTextAreaElement||e instanceof HTMLInputElement&&e.type==="text"?S(e):e.isContentEditable?E(e):"":""}function d(t){const e=t.getSelection();return e?o(e.toString()):""}function A(t){const e=t.querySelector("textarea.kix-clipboard-input");return e?a(e.value||""):""}class x{constructor(){i(this,"site","google-docs");i(this,"cleanup",[]);i(this,"onClaim",null)}start(e){this.onClaim=e,this.attachDocumentListeners(document);const n=new MutationObserver(()=>{const s=Array.from(document.querySelectorAll("iframe"));for(const r of s)try{const u=r.contentDocument;u&&this.attachDocumentListeners(u)}catch{}});n.observe(document.documentElement,{childList:!0,subtree:!0}),this.cleanup.push(()=>n.disconnect())}getSelectedText(){const e=d(document);return e||Array.from(document.querySelectorAll("iframe")).map(s=>{try{return d(s.contentDocument)}catch{return""}}).filter(Boolean)[0]||""}destroy(){for(const e of this.cleanup)e();this.cleanup=[],this.onClaim=null}attachDocumentListeners(e){if(e.__sourceFinderBound)return;e.__sourceFinderBound=!0;const n=()=>{const r=this.extractClaimCandidate(e);r&&this.onClaim&&this.onClaim(r)},s=["keyup","input","compositionend","mouseup"];for(const r of s)e.addEventListener(r,n,!0);this.cleanup.push(()=>{for(const r of s)e.removeEventListener(r,n,!0)})}extractClaimCandidate(e){const n=d(e),s=a(n);if(l(s))return o(s);const r=m(e);if(l(r))return o(r);const u=A(e);return l(u)?o(u):""}}class L{constructor(){i(this,"site","word-web");i(this,"cleanup",[]);i(this,"onClaim",null)}start(e){this.onClaim=e;const n=()=>{const r=this.extractClaimCandidate(document);r&&this.onClaim&&this.onClaim(r)},s=["keyup","input","compositionend","mouseup"];for(const r of s)document.addEventListener(r,n,!0);this.cleanup.push(()=>{for(const r of s)document.removeEventListener(r,n,!0)})}getSelectedText(){return d(document)}destroy(){for(const e of this.cleanup)e();this.cleanup=[],this.onClaim=null}extractClaimCandidate(e){const n=d(e),s=a(n);if(l(s))return o(s);const r=m(e);return l(r)?o(r):""}}function y(){const t=window.location.hostname;return t==="docs.google.com"?new x:t==="word.office.com"?new L:null}function f(t,e,n){const s={type:"CLAIM_CANDIDATE",claim:e,mode:n,site:t.site};chrome.runtime.sendMessage(s)}function b(t){const e=o(t.getSelectedText());if(!e)return"";const n=a(e);return o(n||e)}const c=y();c&&(c.start(t=>{f(c,o(t),"auto")}),chrome.runtime.onMessage.addListener(t=>{if(!t||t.type!=="MANUAL_LOOKUP_REQUEST")return;const e=b(c);if(!e){const n={type:"MANUAL_LOOKUP_EMPTY",site:c.site};chrome.runtime.sendMessage(n);return}f(c,e,"manual")}),window.addEventListener("beforeunload",()=>{c.destroy()}));

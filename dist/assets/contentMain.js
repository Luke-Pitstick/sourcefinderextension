var C=Object.defineProperty;var g=(t,e,n)=>e in t?C(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var c=(t,e,n)=>g(t,typeof e!="symbol"?e+"":e,n);const v=["is","are","was","were","be","has","have","had","did","does","do","shows","show","suggests","suggest","demonstrates","demonstrate","indicates","indicate","states","state","reports","report","finds","find","found","supports","support","causes","cause","correlates","correlate","improves","improve","reduces","reduce","increases","increase","invades","invaded"];function S(t){return t.toLowerCase().match(/[a-z']+/g)||[]}function x(t){return t.some(e=>v.includes(e))?!0:t.some(e=>e.length<4?!1:!!(/(ed|ing)$/.test(e)||e.endsWith("s")&&!e.endsWith("ss")&&e.length>=5))}function s(t){return t.replace(/\s+/g," ").trim()}function u(t){const e=s(t);if(!e)return"";const n=e.split(new RegExp("(?<=[.!?;:])\\s+")).filter(Boolean);if(n.length===0)return"";const r=s(n[n.length-1]),o=n.length>1?s(n[n.length-2]):"";return/[.!?;:]$/.test(r)?r:o}function l(t){const e=s(t);if(!e||!/[.!?;:]$/.test(e))return!1;const n=S(e);return n.length<4?!1:x(n)}function E(t){const e=t.selectionStart??t.value.length,n=t.value.slice(0,e);return u(n)}function y(t){return t.tagName.toLowerCase()==="textarea"}function A(t){return t.tagName.toLowerCase()!=="input"?!1:(t.type||"text").toLowerCase()==="text"}function b(t){const e=t.ownerDocument.getSelection();if(!e||e.rangeCount===0)return"";const n=e.getRangeAt(0).cloneRange();n.setStart(t,0);const r=n.toString();return u(r||t.textContent||"")}function h(t){const e=t.activeElement;if(!e)return"";if(y(e)||A(e))return E(e);const n=e;return n.isContentEditable?b(n):""}function d(t){const e=t.getSelection();return e?s(e.toString()):""}function f(t){const e=["textarea.kix-clipboard-input",'textarea[aria-label*="Ctrl+C"]','textarea[aria-label*="âŒ˜C"]'];for(const n of e){const r=t.querySelector(n);if(!r)continue;const o=s(r.value||r.textContent||"");if(o)return o}return""}function _(t){return u(f(t))}class L{constructor(){c(this,"site","google-docs");c(this,"cleanup",[]);c(this,"onClaim",null)}start(e){this.onClaim=e,this.attachDocumentListeners(document);const n=new MutationObserver(()=>{const r=Array.from(document.querySelectorAll("iframe"));for(const o of r)try{const i=o.contentDocument;i&&this.attachDocumentListeners(i)}catch{}});n.observe(document.documentElement,{childList:!0,subtree:!0}),this.cleanup.push(()=>n.disconnect())}getSelectedText(){const e=d(document);if(e)return e;const n=Array.from(document.querySelectorAll("iframe")).map(i=>{try{return d(i.contentDocument)}catch{return""}}).filter(Boolean);if(n[0])return n[0];const r=f(document);return r||Array.from(document.querySelectorAll("iframe")).map(i=>{try{const m=i.contentDocument;return m?f(m):""}catch{return""}}).filter(Boolean)[0]||""}destroy(){for(const e of this.cleanup)e();this.cleanup=[],this.onClaim=null}attachDocumentListeners(e){if(e.__sourceFinderBound)return;e.__sourceFinderBound=!0;const n=()=>{const o=this.extractClaimCandidate(e);o&&this.onClaim&&this.onClaim(o)},r=["keyup","input","compositionend","mouseup"];for(const o of r)e.addEventListener(o,n,!0);this.cleanup.push(()=>{for(const o of r)e.removeEventListener(o,n,!0)})}extractClaimCandidate(e){const n=d(e),r=u(n);if(l(r))return s(r);const o=h(e);if(l(o))return s(o);const i=_(e);return l(i)?s(i):""}}class T{constructor(){c(this,"site","word-web");c(this,"cleanup",[]);c(this,"onClaim",null)}start(e){this.onClaim=e;const n=()=>{const o=this.extractClaimCandidate(document);o&&this.onClaim&&this.onClaim(o)},r=["keyup","input","compositionend","mouseup"];for(const o of r)document.addEventListener(o,n,!0);this.cleanup.push(()=>{for(const o of r)document.removeEventListener(o,n,!0)})}getSelectedText(){return d(document)}destroy(){for(const e of this.cleanup)e();this.cleanup=[],this.onClaim=null}extractClaimCandidate(e){const n=d(e),r=u(n);if(l(r))return s(r);const o=h(e);return l(o)?s(o):""}}function w(){const t=window.location.hostname;return t==="docs.google.com"?new L:t==="word.office.com"?new T:null}function p(t,e,n){const r={type:"CLAIM_CANDIDATE",claim:e,mode:n,site:t.site};chrome.runtime.sendMessage(r)}function N(t){const e=s(t.getSelectedText());if(!e)return"";const n=u(e);return s(n||e)}const a=w();a&&!window.__sourceFinderContentBooted&&(window.__sourceFinderContentBooted=!0,a.start(t=>{p(a,s(t),"auto")}),chrome.runtime.onMessage.addListener((t,e,n)=>{if(!t)return;if(t.type==="PING_CONTENT_SCRIPT"){n({ok:!0});return}if(t.type!=="MANUAL_LOOKUP_REQUEST")return;const r=N(a);if(!r){const o={type:"MANUAL_LOOKUP_EMPTY",site:a.site};chrome.runtime.sendMessage(o),n({ok:!1,empty:!0});return}p(a,r,"manual"),n({ok:!0})}),window.addEventListener("beforeunload",()=>{a.destroy()}));
